# 1.2 Assertions e Estrutura B√°sica [B√ÅSICO]

üéØ **Objetivo:** Dominar as assertions do JUnit 5, entender o padr√£o AAA (Arrange-Act-Assert) e criar testes simples e eficazes.

---

## Criando Testes Simples com `@Test`

A anota√ß√£o `@Test` √© o ponto de partida de qualquer teste no JUnit Jupiter. Ela marca um m√©todo como sendo um m√©todo de teste.

üí° **Diferente do JUnit 4:** Os m√©todos de teste n√£o precisam ser p√∫blicos; o acesso a n√≠vel de pacote (padr√£o) √© suficiente, tornando o c√≥digo mais limpo.

---

## üéØ Padr√£o AAA (Arrange-Act-Assert)

Uma boa pr√°tica fundamental ao escrever testes √© seguir o padr√£o **Arrange-Act-Assert (AAA)**:

### 1. **Arrange (Organizar)**

Prepare o ambiente do teste:

- Instanciar objetos
- Preparar mocks
- Definir estado inicial

### 2. **Act (Agir)**

Execute a a√ß√£o ou m√©todo que voc√™ deseja testar.

### 3. **Assert (Verificar)**

Valide se o resultado foi o esperado usando m√©todos de asser√ß√£o.

### üß™ Exemplo B√°sico

```java
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.assertEquals;

class StringUtilsTest {

    @Test
    void deveConcatenarDuasStrings() {
        // Arrange
        String str1 = "JUnit 5";
        String str2 = " √© incr√≠vel!";

        // Act
        String resultado = str1.concat(str2);

        // Assert
        assertEquals("JUnit 5 √© incr√≠vel!", resultado);
    }
}
```

---

## üß™ Principais Assertions

O JUnit 5 fornece a classe `org.junit.jupiter.api.Assertions` com m√©todos ricos para valida√ß√£o. √â comum import√°-los estaticamente para maior legibilidade.

### Assertions B√°sicas

| Assertion                                   | Uso                                  | Exemplo                            |
| ------------------------------------------- | ------------------------------------ | ---------------------------------- |
| `assertEquals(expected, actual, [message])` | Verifica igualdade (usa `.equals()`) | `assertEquals(5, calc.soma(2, 3))` |
| `assertNotEquals(unexpected, actual)`       | Verifica desigualdade                | `assertNotEquals(0, resultado)`    |
| `assertTrue(condition, [message])`          | Verifica se condi√ß√£o √© verdadeira    | `assertTrue(lista.isEmpty())`      |
| `assertFalse(condition, [message])`         | Verifica se condi√ß√£o √© falsa         | `assertFalse(texto.isEmpty())`     |
| `assertNull(object, [message])`             | Verifica se objeto √© nulo            | `assertNull(usuarioNaoEncontrado)` |
| `assertNotNull(object, [message])`          | Verifica se objeto n√£o √© nulo        | `assertNotNull(usuario)`           |

### Assertions Avan√ßadas

| Assertion                                | Uso                                      | Benef√≠cio                                    |
| ---------------------------------------- | ---------------------------------------- | -------------------------------------------- |
| `assertThrows(expectedType, executable)` | Verifica se exce√ß√£o √© lan√ßada            | Retorna a exce√ß√£o para valida√ß√µes adicionais |
| `assertDoesNotThrow(executable)`         | Verifica que nenhuma exce√ß√£o √© lan√ßada   | √ötil para validar c√≥digo que deve ser seguro |
| `assertAll(executables...)`              | Agrupa m√∫ltiplas asser√ß√µes               | **Executa todas** e reporta todas as falhas  |
| `assertTimeout(duration, executable)`    | Verifica limite de tempo                 | Falha se executar mais devagar que esperado  |
| `assertSame(expected, actual)`           | Verifica identidade de refer√™ncia (`==`) | Diferente de `equals()`                      |

---

## üß™ Exemplo: assertThrows

Uma das asser√ß√µes mais √∫teis para validar comportamento de erro.

```java
import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.Test;
import java.util.EmptyStackException;
import java.util.Stack;

class ExceptionTest {

    @Test
    void deveLancarExcecaoAoRemoverDePilhaVazia() {
        Stack<String> stack = new Stack<>();

        // Verifica o tipo da exce√ß√£o E captura para valida√ß√µes adicionais
        Exception exception = assertThrows(EmptyStackException.class, () -> {
            stack.pop(); // Act
        });

        // Opcional: validar mensagem da exce√ß√£o
        // assertEquals("Pilha vazia", exception.getMessage());
    }

    @Test
    void deveAceitarDivisaoPorNumeroValido() {
        Calculadora calc = new Calculadora();

        // Verifica que NENHUMA exce√ß√£o √© lan√ßada
        assertDoesNotThrow(() -> {
            double resultado = calc.dividir(10, 2);
            assertEquals(5.0, resultado);
        });
    }
}
```

---

## üß™ assertAll: Agrupando Asser√ß√µes

**Problema:** Asser√ß√µes sequenciais param na primeira falha. Voc√™ n√£o v√™ todas as falhas de uma vez.

**Solu√ß√£o:** `assertAll()` executa **todas** as asser√ß√µes e reporta **todas** as falhas juntas.

```java
import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.Test;
import java.util.Stack;

class AssertAllDemoTest {

    @Test
    void demonstracaoDeAssercoes() {
        Stack<String> stack = new Stack<>();
        stack.push("JUnit 5");

        // Agrupando asser√ß√µes - TODAS s√£o executadas
        assertAll("Propriedades da Pilha",
            () -> assertEquals(1, stack.size(),
                "O tamanho da pilha deve ser 1"),
            () -> assertFalse(stack.isEmpty(),
                "A pilha n√£o deveria estar vazia"),
            () -> assertEquals("JUnit 5", stack.peek(),
                "O elemento no topo deve ser 'JUnit 5'")
        );
    }
}
```

üí° **Benef√≠cio:** Se 2 das 3 asser√ß√µes falharem, voc√™ v√™ **ambas** as falhas no relat√≥rio, economizando ciclos de teste.

---

## ‚ö† Pitfalls Comuns

### 1. Ordem de Par√¢metros Invertida

```java
// ‚ùå ERRADO - ordem invertida
assertEquals(resultado, 5);

// ‚úÖ CORRETO - (esperado, atual)
assertEquals(5, resultado);
```

**Por qu√™?** A mensagem de erro fica confusa se invertido.

### 2. Testar M√∫ltiplas Coisas Sem assertAll

```java
// ‚ùå Para na primeira falha
assertEquals(5, calc.soma(2, 3));
assertEquals(10, calc.soma(5, 5));  // Nunca executado se primeiro falhar

// ‚úÖ Reporta todas as falhas
assertAll(
    () -> assertEquals(5, calc.soma(2, 3)),
    () -> assertEquals(10, calc.soma(5, 5))
);
```

### 3. N√£o Usar Mensagens Descritivas

```java
// ‚ùå Mensagem de erro gen√©rica
assertEquals(expected, actual);

// ‚úÖ Contexto claro
assertEquals(expected, actual,
    "C√°lculo de desconto para cliente VIP deve ser 20%");
```

### 4. assertSame vs assertEquals

```java
String a = new String("test");
String b = new String("test");

assertEquals(a, b);   // ‚úÖ Passa (conte√∫do igual)
assertSame(a, b);     // ‚ùå Falha (objetos diferentes)
```

### 5. N√£o Validar a Mensagem da Exce√ß√£o

```java
// ‚ùå Valida s√≥ o tipo
assertThrows(IllegalArgumentException.class, () -> metodo());

// ‚úÖ Valida tipo E mensagem
Exception ex = assertThrows(IllegalArgumentException.class, () -> metodo());
assertEquals("ID n√£o pode ser negativo", ex.getMessage());
```

---

## ‚úÖ Checklist de Boas Pr√°ticas

- [ ] Seguir padr√£o AAA (Arrange-Act-Assert) em todos os testes
- [ ] Usar `assertAll()` para m√∫ltiplas valida√ß√µes relacionadas
- [ ] Adicionar mensagens descritivas nas asser√ß√µes cr√≠ticas
- [ ] Validar mensagem de exce√ß√µes, n√£o apenas o tipo
- [ ] Ordem correta: `assertEquals(esperado, atual)`
- [ ] Usar `assertSame()` s√≥ quando identidade de objeto importa
- [ ] Preferir `assertTrue(lista.isEmpty())` sobre `assertEquals(true, lista.isEmpty())`

---

## üìä Comparativo: Assertions vs Hamcrest vs AssertJ

| Framework            | Estilo        | Exemplo                              |
| -------------------- | ------------- | ------------------------------------ |
| **JUnit Assertions** | Tradicional   | `assertEquals(5, resultado)`         |
| **Hamcrest**         | Matcher-based | `assertThat(resultado, is(5))`       |
| **AssertJ**          | Fluent        | `assertThat(resultado).isEqualTo(5)` |

üí° **Recomenda√ß√£o:** Comece com JUnit Assertions. Migre para AssertJ quando precisar de valida√ß√µes complexas ou maior legibilidade.

---

## üß† Perguntas Reflexivas

1. Por que `assertAll()` √© prefer√≠vel a m√∫ltiplas asser√ß√µes sequenciais?
2. Quando voc√™ usaria `assertSame()` em vez de `assertEquals()`?
3. Como `assertThrows()` melhora a legibilidade comparado a try-catch?
4. Qual o impacto de n√£o adicionar mensagens descritivas em asser√ß√µes?

---

## üß™ Exerc√≠cio Pr√°tico

Crie testes para uma classe `Carrinho`:

```java
class Carrinho {
    private List<Item> itens = new ArrayList<>();

    void adicionar(Item item) {
        if (item == null) throw new IllegalArgumentException("Item n√£o pode ser nulo");
        itens.add(item);
    }

    double calcularTotal() {
        return itens.stream().mapToDouble(Item::getPreco).sum();
    }

    boolean estaVazio() {
        return itens.isEmpty();
    }
}
```

**Implemente testes para:**

1. Adicionar item v√°lido
2. Adicionar item nulo (deve lan√ßar exce√ß√£o)
3. Calcular total com m√∫ltiplos itens
4. Verificar carrinho vazio

---

## üìö Pr√≥ximos Passos

- [1.3 Ciclo de Vida dos Testes](01.3-ciclo-vida.md) - @BeforeEach, @AfterEach, @BeforeAll, @AfterAll
- [1.4 Testes Parametrizados](01.4-testes-parametrizados.md) - @ValueSource, @CsvSource
- [Voltar ao √çndice](../../README.md)

---

**√öltima Atualiza√ß√£o:** 2025-11-14  
**N√≠vel:** [B√ÅSICO]  
**Tempo Estimado:** 1 hora
